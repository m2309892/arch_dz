# Runner - Обработка видео и работа с Inference

## Описание

Runner выполняет следующие функции:

1. **Чтение кадра** - чтение кадров из заготовленного локального видео
2. **Отправка кадра** - отправка кадра в Inference сервис
3. **Получение результата** - чтение результатов с предсказаниями от Inference
4. **Организация результата** - сохранение предсказаний в БД и обновление статуса сценария на `active`

## Структура

```
app/runner/
  __init__.py              # Экспорт Runner
  runner.py                # Главный класс Runner
  video_processor.py       # Обработка видео и извлечение кадров
  inference_client.py      # Клиент для работы с Inference сервисом
```

## Тестирование

### Видеофайл для тестов

Для тестирования Runner нужно поместить видеофайл в папку `test_videos/` в корне проекта.

**Путь по умолчанию:** `test_videos/test_video.mp4`

Вы можете использовать любой видеофайл (MP4, AVI и т.д.). В текущей реализации используется заглушка, но для реальной работы нужно:

1. Создать папку `test_videos/` в корне проекта
2. Поместить туда видеофайл (например, `test_video.mp4`)
3. Указать путь к видео при создании Runner

### Пример использования

```python
from app.runner import Runner

# Создание раннера
runner = Runner(
    runner_id="runner_1",
    video_path="test_videos/test_video.mp4",
    inference_url="http://localhost:8001"
)

# Запуск раннера
await runner.start()

# Обработка сценария
success = await runner.process_scenario(scenario_id=1)

# Остановка раннера
await runner.stop()
```

## Обработка ошибок

Если Runner не может обработать inference (любая ошибка при работе), он:
1. Отправляет событие в retry топик Kafka с информацией об ошибке
2. Останавливает свою работу (умирает)

Оркестратор затем получит событие из retry топика и создаст новый раннер для обработки.

## Зависимости

Для реальной работы с видео потребуется добавить в `requirements.txt`:
```
opencv-python==4.8.1.78  # Для работы с видео
```

Но пока используются заглушки, эти зависимости не требуются.

